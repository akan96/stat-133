---
  title: "Question 3"
author: "Avery Kan"
date: "Apr 25, 2016"
output: 
  html_document:
  fig_height: 3
fig_width: 5
---
  <!-- Don't edit in between this line and the one below -->
```{r include=FALSE}
# Don't delete this chunk if you are using the DataComputing package
library(DataComputing)
```
*Source file* 
  ```{r, results='asis', echo=FALSE}
includeSourceDocuments()
```
<!-- Don't edit the material above this line -->

## Stat 133 Final Project: Yelp
## Avery Kan: What kind of restaurant have large variations in the ratings?

## Calculate the standard deviation of the ratings for each type of restaurant
```{r}
Businesses <- read.csv("C:/Users/user/Google Drive/Stat 133 Final Project/Businesses.csv")
Complete <- read.file("C:/Users/user/Google Drive/Stat 133 Final Project/Complete.csv")
```


Cleaning up the data

```{r}
Businesses <- 
Businesses%>%
mutate(attributes= gsub("u'","",attributes),
categories= gsub("u'","",categories),
neighborhoods=gsub("u'","",neighborhoods))
```

Filter for open restaurants

```{r}
Open <- 
Businesses %>% 
filter(grepl("Restaurant",categories))
```


Inner-join to form Reviews table
```{r}
Reviews <- Open %>%
select(name,business_id,city,categories,attributes) %>%
inner_join(Complete[,-(1:4)],by= c("business_id"="business_id"))
```


Average reviews
```{r}
AvgReviews <- 
Reviews %>%
select(name, city, categories, attributes, stars) %>% 
group_by(name) %>%
mutate_each(funs(mean(., na.rm=TRUE)), stars) %>% 
arrange(desc(stars)) 
Avg <- 
AvgReviews[!duplicated(AvgReviews[,1]),]
```

Cleanup categories

```{r}
cat <- Avg %>% 
select(-attributes) %>% 
mutate(categories= gsub("Restaurants","",categories))
cat <- cat %>% 
mutate(categories= gsub("'","",categories),
categories= gsub(", ]","",categories),
categories= gsub("]","",categories),
categories= gsub("\\[","",categories))
```

Separating into different categories

```{r} 
sepcat <- cat %>%
separate(categories, into = c("prim", "sec", "tert", "quart"),sep = ",", extra= "merge")

sepcat1 <- sepcat %>% group_by(prim,sec) %>% summarize(avg= mean(stars), sd= sd(stars))
head(sepcat1)
```

Cleanup attributes
```{r}
att <- Avg %>% 
select(-categories) %>% 
mutate(attributes= gsub("Restaurants","",attributes))
att <- att %>% 
mutate(attributes= gsub("'","",attributes),
attributes= gsub("\\{","",attributes),
  attributes= gsub("\\}","",attributes))
```


Obtain list of dataframes with attributes
```{r}
attl <- att$attributes %>% str_match_all(",([^,]*): ([^,]*)")
for (i in 1: length(attl)){
attl[[i]] <- attl[[i]][,2:3]
}

for (i in 1: length(attl)){
attl[[i]]= as.data.frame(attl[[i]])
}
for (i in 1: length(attl)){
if (ncol(attl[[i]]) < 2){
  attl[[i]] <- attl[[1]]
}
}
for (i in 1: length(attl)){
rownames(attl[[i]]) <- attl[[i]][,1]
}
for (j in 1: length(attl)){
colnames(attl[[j]])= c(2*j-1, 2*j)
}
```


Merge list of dataframes

```{r}
merge1 <- attl[[1]]
for (i in 2:635){
  merge1 <- merge(merge1, attl[[i]], by = 0 ,all.x= TRUE)
  rownames(merge1) <- merge1$Row.names
  merge1 <- merge1 %>% select(-Row.names)
  }

```

```{r}
merge2 <- attl[[635]]
for (i in 636:1318){
merge2 <- merge(merge2, attl[[i]], by = "row.names", all.x= TRUE) 
rownames(merge2) <- merge$Row.names
merge2 <- merge2 %>% select(-Row.names)
}
```

More cleaning up after merging

```{r}

satt <- merge %>% t() %>% as.data.frame()
c <- 1: nrow(satt)
satt2 <- satt[(c%%2==0), ]
```

Joining names, stars back to attributes 

```{r}
satt3 <- cbind(att, satt2)
rownames(satt3) <- 1:803
```


Start analysis of attributes, filtering out ones that are not used.

1. Alcohol {Full bar, beer, none}

```{r}

satt4 <- satt3[,-c(4,11,15,16,19,24,28,29,31,32,36,37:41)]
satt4 <- satt4 %>% ungroup()
alcfull <- satt4 %>% filter(` Alcohol`== "full_bar") %>% summarize(avg= mean(stars), stdev= sd(stars))
alcbeer <- satt4 %>% filter(` Alcohol`== "beer_and_wine") %>% summarize(avg= mean(stars), stdev= sd(stars))
alcnone <- satt4 %>% filter(` Alcohol`== "none") %>% summarize(avg= mean(stars), stdev= sd(stars))

attalc <- rbind(alcfull,alcbeer,alcnone)
rownames(attalc) <- c("fullbar","beer and wine","none")

```



2. Ambience{romantic, intimate, touristy, trendy, upscale, hipster}

```{r}
ro <- satt4 %>% filter(` Ambience: romantic`== "True") %>% summarize(avg= mean(stars), stdev= sd(stars))
int <- satt4 %>% filter(` intimate`== "True") %>% summarize(avg= mean(stars), stdev= sd(stars))
tour <- satt4 %>% filter(` touristy`== "True") %>% summarize(avg= mean(stars), stdev= sd(stars))
trendy <- satt4 %>% filter(` trendy`== "True") %>% summarize(avg= mean(stars), stdev= sd(stars))
upscale <- satt4 %>% filter(` upscale`== "True") %>% summarize(avg= mean(stars), stdev= sd(stars))
hipster <- satt4 %>% filter(` hipster`== "True") %>% summarize(avg= mean(stars), stdev= sd(stars))
ambience <- rbind(ro,int,tour,trendy,upscale,hipster)
rownames(ambience) <- c("romantic","intimate","touristy","trendy","upscale","hipster")
```

3. Good for {groups, kids}

```{r}
groups <- satt4 %>% filter(` Good For Groups` == "True") %>% summarize(avg= mean(stars), stdev= sd(stars))
kids <- satt4 %>% filter(` Good for Kids` == "True") %>% summarize(avg= mean(stars), stdev= sd(stars))
good <- rbind(groups,kids)
neither <- satt4 %>% filter(` Good For Groups` == "False" & ` Good for Kids` == "False") %>% summarize(avg= mean(stars), stdev= sd(stars))
good <- rbind(groups,kids,neither)
rownames(good) <- c("groups","kids","neither")
```

4. Noise {very loud, loud, average, quiet}

```{r}
very_loud <- satt4 %>% filter(` Noise Level` == "very_loud") %>% summarize(avg= mean(stars), stdev= sd(stars))

loud <- satt4 %>% filter(` Noise Level` == "loud") %>% summarize(avg= mean(stars), stdev= sd(stars))

average <- satt4 %>% filter(` Noise Level` == "average") %>% summarize(avg= mean(stars), stdev= sd(stars))

quiet <- satt4 %>% filter(` Noise Level` == "quiet") %>% summarize(avg= mean(stars), stdev= sd(stars))

noise <- rbind(very_loud,loud,average,quiet)
rownames(noise) <- c("very loud","loud", "average","quiet")

noise %>% ggplot(aes(x=1:4, y= avg)) +
geom_point(aes(size=3))+
stat_smooth()
```

5. Attire {formal, dressy, casual}

```{r}
formal <- satt4 %>% filter(` Attire` == "formal") %>% summarize(avg= mean(stars), stdev= sd(stars))

dressy <- satt4 %>% filter(` Attire` == "dressy") %>% summarize(avg= mean(stars), stdev= sd(stars))

casual <- satt4 %>% filter(` Attire` == "casual") %>% summarize(avg= mean(stars), stdev= sd(stars))

attire <- rbind(formal,dressy, casual)
rownames(attire) <- c("formal","dressy", "casual")
```


6. Price Range {1, 2, 3, 4}

```{r}
one <- satt4 %>% filter(` Price Range` == 1) %>% summarize(avg= mean(stars), stdev= sd(stars))
two <- satt4 %>% filter(` Price Range` == 2) %>% summarize(avg= mean(stars), stdev= sd(stars))
three <- satt4 %>% filter(` Price Range` == 3) %>% summarize(avg= mean(stars), stdev= sd(stars))
four <- satt4 %>% filter(` Price Range` == 4) %>% summarize(avg= mean(stars), stdev= sd(stars))

price <- rbind(one,two,three,four)
rownames(price) <- rbind("one","two","three","four")
```

7. Meals: {breakfast, brunch, lunch, dinner, late night}

```{r}


breakfast <- satt4 %>% filter(` breakfast` == "True") %>% summarize(avg= mean(stars), stdev= sd(stars))
brunch <- satt4 %>% filter(` brunch` == "True") %>% summarize(avg= mean(stars), stdev= sd(stars))
lunch <- satt4 %>% filter(` lunch` == "True") %>% summarize(avg= mean(stars), stdev= sd(stars))
dinner <- satt4 %>% filter(` dinner` == "True") %>% summarize(avg= mean(stars), stdev= sd(stars))
latenight <- satt4 %>% filter(` latenight` == "True") %>% summarize(avg= mean(stars), stdev= sd(stars))
meals <- rbind(breakfast,brunch,lunch,dinner,latenight)
rownames(meals) <- c("breakfast","brunch","lunch","dinner","latenight")
```


8. Counter/Delivery

```{r}

counter <- satt4 %>% filter(` Order at Counter` == "True")%>% summarize(avg= mean(stars), stdev= sd(stars))
notcounter <- satt4 %>% filter(` Order at Counter` == "False")%>% summarize(avg= mean(stars), stdev= sd(stars))

delivery <- satt4  %>%  filter(` Delivery` == "True")%>% summarize(avg= mean(stars), stdev= sd(stars))
notdelivery <-satt4 %>% filter(` Delivery` == "False")%>% summarize(avg= mean(stars), stdev= sd(stars))

alternative <- rbind(counter,notcounter,delivery,notdelivery)
rownames(alternative) <- c("counter","notcounter","delivery","notdelivery")

```

Combining all

```{r}

all <- rbind(attalc,ambience,good,noise,attire,price, meals, alternative)
head(all,50)

```
